"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[643],{2643:(z,v,o)=>{o.r(v),o.d(v,{HealthCheckComponent:()=>p,JobListComponent:()=>u,JobStateLabelComponent:()=>_,SystemModule:()=>b,systemRoutes:()=>E});var e=o(5703),a=o(1644),d=o(1533),i=o(6884),f=o(7244),m=o(6944),y=o(4955),T=o(3082),C=o(137),D=o(7589),h=o(6088),g=o(9015),j=o(405);const M=(n,r)=>({"is-success":n,"is-danger":r});function R(n,r){1&n&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"system.health-all-systems-up")," "))}function P(n,r){1&n&&(e.EFF(0),e.nI1(1,"translate")),2&n&&e.SpI(" ",e.bMT(1,1,"system.health-error")," ")}function k(n,r){if(1&n&&(e.j41(0,"div",9)(1,"div",10),e.nrm(2,"clr-icon",11),e.k0s(),e.j41(3,"div",12),e.DNE(4,R,3,3,"ng-container",13)(5,P,2,3,"ng-template",null,0,e.C5r),e.j41(7,"div",14),e.EFF(8),e.nI1(9,"translate"),e.nI1(10,"async"),e.nI1(11,"localeDate"),e.k0s()()()),2&n){const t=r.ngIf,s=e.sdS(6),l=e.XpG();e.R7$(2),e.Y8G("ngClass",e.l_i(13,M,"ok"===t,"ok"!==t)),e.BMQ("shape","ok"===t?"check-circle":"exclamation-circle"),e.R7$(2),e.Y8G("ngIf","ok"===t)("ngIfElse",s),e.R7$(4),e.Lme(" ",e.bMT(9,6,"system.health-last-checked"),": ",e.i5U(11,10,e.bMT(10,8,l.healthCheckService.lastCheck$),"mediumTime")," ")}}function F(n,r){1&n&&(e.qex(0),e.nrm(1,"clr-icon",17),e.EFF(2),e.nI1(3,"translate"),e.bVm()),2&n&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"system.health-status-up")," "))}function $(n,r){1&n&&(e.nrm(0,"clr-icon",18),e.EFF(1),e.nI1(2,"translate")),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"system.health-status-down")," "))}function L(n,r){if(1&n&&(e.j41(0,"tr")(1,"td",15),e.EFF(2),e.k0s(),e.j41(3,"td",15)(4,"vdr-chip",16),e.DNE(5,F,4,3,"ng-container",13)(6,$,3,3,"ng-template",null,1,e.C5r),e.k0s()(),e.j41(8,"td",15),e.EFF(9),e.k0s()()),2&n){const t=r.$implicit,s=e.sdS(7);e.R7$(2),e.JRh(t.key),e.R7$(2),e.Y8G("colorType","up"===t.result.status?"success":"error"),e.R7$(),e.Y8G("ngIf","up"===t.result.status)("ngIfElse",s),e.R7$(4),e.JRh(t.result.message)}}function O(n,r){if(1&n&&(e.j41(0,"span",3),e.EFF(1),e.nI1(2,"percent"),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.job.progress/100)," ")}}const w=()=>["DeleteSettings","DeleteSystem"];function G(n,r){1&n&&(e.qex(0),e.j41(1,"vdr-chip"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.bVm()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,1,"system.all-job-queues")))}function N(n,r){if(1&n&&(e.j41(0,"vdr-chip",20),e.EFF(1),e.k0s()),2&n){const t=e.XpG().item;e.Y8G("colorFrom",t.name),e.R7$(),e.JRh(t.name)}}function S(n,r){if(1&n&&e.DNE(0,G,4,3,"ng-container",19)(1,N,2,2,"ng-template",null,0,e.C5r),2&n){const t=r.item,s=e.sdS(2);e.Y8G("ngIf","all"===t.name)("ngIfElse",s)}}function U(n,r){if(1&n&&e.EFF(0),2&n){const t=r.item;e.SpI(" ",t.id," ")}}function J(n,r){if(1&n&&(e.EFF(0),e.nI1(1,"timeAgo")),2&n){const t=r.item;e.SpI(" ",e.bMT(1,1,t.createdAt)," ")}}function A(n,r){if(1&n&&(e.j41(0,"vdr-chip",20),e.EFF(1),e.k0s()),2&n){const t=r.item;e.Y8G("colorFrom",t.queueName),e.R7$(),e.JRh(t.queueName)}}function x(n,r){if(1&n&&(e.j41(0,"vdr-dropdown")(1,"button",22),e.nI1(2,"translate"),e.nrm(3,"clr-icon",23),e.k0s(),e.j41(4,"vdr-dropdown-menu")(5,"div",24),e.nrm(6,"vdr-object-tree",5),e.k0s()()()),2&n){const t=e.XpG().item;e.R7$(),e.Y8G("title",e.bMT(2,2,"system.job-data")),e.R7$(5),e.Y8G("value",t.data)}}function Y(n,r){if(1&n&&e.DNE(0,x,7,4,"vdr-dropdown",21),2&n){const t=r.item;e.Y8G("ngIf",t.data)}}function B(n,r){if(1&n&&(e.j41(0,"div",27),e.EFF(1),e.k0s()),2&n){const t=e.XpG().item;e.R7$(),e.SpI("after ",t.attempts," attempts")}}function W(n,r){if(1&n&&(e.j41(0,"div",27),e.EFF(1),e.k0s()),2&n){const t=e.XpG().item;e.R7$(),e.Lme(" attempting ",t.attempts," of ",t.retries+1," ")}}function K(n,r){if(1&n&&(e.nrm(0,"vdr-job-state-label",25),e.DNE(1,B,2,1,"div",26)(2,W,2,2,"div",26)),2&n){const t=r.item;e.Y8G("job",t),e.R7$(),e.Y8G("ngIf","FAILED"===t.state),e.R7$(),e.Y8G("ngIf","RUNNING"===t.state||"RETRYING"===t.state)}}function q(n,r){if(1&n&&(e.EFF(0),e.nI1(1,"duration")),2&n){const t=r.item;e.SpI(" ",e.bMT(1,1,t.duration)," ")}}function H(n,r){if(1&n&&(e.j41(0,"vdr-dropdown")(1,"button",28),e.nrm(2,"clr-icon",23),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"vdr-dropdown-menu")(6,"div",24),e.nrm(7,"vdr-object-tree",5),e.k0s()()()),2&n){const t=e.XpG().item;e.R7$(3),e.SpI(" ",e.bMT(4,2,"system.job-result")," "),e.R7$(4),e.Y8G("value",t.result)}}function X(n,r){if(1&n&&(e.j41(0,"vdr-dropdown")(1,"button",29),e.nrm(2,"clr-icon",30),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"vdr-dropdown-menu")(6,"div",24),e.EFF(7),e.k0s()()()),2&n){const t=e.XpG().item;e.R7$(3),e.SpI(" ",e.bMT(4,2,"system.job-error")," "),e.R7$(4),e.SpI(" ",t.error," ")}}function V(n,r){if(1&n){const t=e.RV6();e.j41(0,"vdr-dropdown")(1,"button",31),e.nrm(2,"clr-icon",32),e.k0s(),e.j41(3,"vdr-dropdown-menu",33)(4,"button",34),e.nI1(5,"hasPermission"),e.bIt("click",function(){e.eBV(t);const l=e.XpG().item,c=e.XpG();return e.Njj(c.cancelJob(l.id))}),e.nrm(6,"clr-icon",35),e.EFF(7),e.nI1(8,"translate"),e.k0s()()()}2&n&&(e.R7$(4),e.Y8G("disabled",!e.bMT(5,2,e.lJ4(6,w))),e.R7$(3),e.SpI(" ",e.bMT(8,4,"common.cancel")," "))}function Q(n,r){if(1&n&&e.DNE(0,H,8,4,"vdr-dropdown",21)(1,X,8,4,"vdr-dropdown",21)(2,V,9,7,"vdr-dropdown",21),2&n){const t=r.item,s=e.XpG();e.Y8G("ngIf",s.hasResult(t)),e.R7$(),e.Y8G("ngIf",t.error),e.R7$(),e.Y8G("ngIf",!t.isSettled&&"FAILED"!==t.state)}}class p{constructor(r){this.healthCheckService=r}static{this.\u0275fac=function(t){return new(t||p)(e.rXU(a.MNd))}}static{this.\u0275cmp=e.VBU({type:p,selectors:[["vdr-health-check"]],decls:30,vars:18,consts:[["error",""],["down",""],["class","system-status-header",4,"ngIf"],["locationId","system-status"],[1,"btn","btn-secondary",3,"click"],["shape","refresh"],[1,"table"],[1,"left"],[4,"ngFor","ngForOf"],[1,"system-status-header"],[1,"status-icon"],["size","48",3,"ngClass"],[1,"status-detail"],[4,"ngIf","ngIfElse"],[1,"last-checked"],[1,"align-middle","left"],[3,"colorType"],["shape","check-circle"],["shape","exclamation-circle"]],template:function(t,s){1&t&&(e.j41(0,"vdr-page-header"),e.nrm(1,"vdr-page-title"),e.k0s(),e.j41(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left"),e.DNE(6,k,12,16,"div",2),e.nI1(7,"async"),e.k0s(),e.j41(8,"vdr-ab-right"),e.nrm(9,"vdr-action-bar-items",3),e.j41(10,"button",4),e.bIt("click",function(){return s.healthCheckService.refresh()}),e.nrm(11,"clr-icon",5),e.EFF(12),e.nI1(13,"translate"),e.k0s()()()(),e.j41(14,"vdr-page-block")(15,"table",6)(16,"thead")(17,"tr")(18,"th",7),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"th",7),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"th",7),e.EFF(25),e.nI1(26,"translate"),e.k0s()()(),e.j41(27,"tbody"),e.DNE(28,L,10,5,"tr",8),e.nI1(29,"async"),e.k0s()()()()),2&t&&(e.R7$(6),e.Y8G("ngIf",e.bMT(7,6,s.healthCheckService.status$)),e.R7$(6),e.SpI(" ",e.bMT(13,8,"system.health-refresh")," "),e.R7$(7),e.SpI(" ",e.bMT(20,10,"common.name")," "),e.R7$(3),e.SpI(" ",e.bMT(23,12,"system.health-status")," "),e.R7$(3),e.SpI(" ",e.bMT(26,14,"system.health-message")," "),e.R7$(3),e.Y8G("ngForOf",e.bMT(29,16,s.healthCheckService.details$)))},dependencies:[d.U4n,i.YU,i.Sq,i.bT,a.nGW,a.wL$,a.TXc,a.wux,a.TcB,a.yvH,a.jgO,a.DDl,a.eH4,i.Jj,f.D9,a.PU$],styles:[".system-status-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header[_ngcontent-%COMP%]   .status-detail[_ngcontent-%COMP%]{font-weight:700;margin-inline-end:6px}.system-status-header[_ngcontent-%COMP%]   .last-checked[_ngcontent-%COMP%]{font-weight:400;color:var(--color-grey-500)}"],changeDetection:0})}}class _{get iconShape(){switch(this.job.state){case a.dqH.COMPLETED:return"check-circle";case a.dqH.FAILED:return"exclamation-circle";case a.dqH.CANCELLED:return"ban";case a.dqH.PENDING:case a.dqH.RETRYING:return"hourglass";case a.dqH.RUNNING:return"sync"}}get colorType(){switch(this.job.state){case a.dqH.COMPLETED:return"success";case a.dqH.FAILED:case a.dqH.CANCELLED:return"error";case a.dqH.PENDING:case a.dqH.RETRYING:return"";case a.dqH.RUNNING:return"warning"}}static{this.\u0275fac=function(t){return new(t||_)}}static{this.\u0275cmp=e.VBU({type:_,selectors:[["vdr-job-state-label"]],inputs:{job:"job"},decls:5,vars:6,consts:[[3,"colorType"],[1,"mr1"],["class","progress",4,"ngIf"],[1,"progress"]],template:function(t,s){1&t&&(e.j41(0,"vdr-chip",0),e.nrm(1,"clr-icon",1),e.EFF(2),e.nI1(3,"titlecase"),e.DNE(4,O,3,3,"span",2),e.k0s()),2&t&&(e.Y8G("colorType",s.colorType),e.R7$(),e.BMQ("shape",s.iconShape),e.R7$(),e.SpI(" ",e.bMT(3,4,s.job.state)," "),e.R7$(2),e.Y8G("ngIf","RUNNING"===s.job.state))},dependencies:[d.U4n,i.bT,a.wux,i.m1,i.PV],styles:[".progress[_ngcontent-%COMP%]{margin-inline-start:3px}clr-icon[_ngcontent-%COMP%]{min-width:12px}"],changeDetection:0})}}class u extends a.pDf{constructor(r,t,s){super(t,s),this.dataService=r,this.liveUpdate=new m.MJ(!0),this.queueFilter=new m.MJ("all"),this.stateFilter=new m.MJ(""),super.setQueryFn((...l)=>this.dataService.settings.getAllJobs(...l),l=>l.jobs,(l,c)=>{const Z="all"===this.queueFilter.value?null:{queueName:{eq:this.queueFilter.value}},I=this.stateFilter.value;return{options:{skip:l,take:c,filter:{...Z,...I?{state:{eq:I}}:{}},sort:{createdAt:a.xBQ.DESC}}}})}ngOnInit(){super.ngOnInit(),(0,y.O)(5e3,2e3).pipe((0,T.Q)(this.destroy$),(0,C.p)(()=>!!this.liveUpdate.value)).subscribe(()=>{this.refresh()}),this.queues$=this.dataService.settings.getJobQueues().mapStream(r=>r.jobQueues).pipe((0,D.T)(r=>[{name:"all",running:!0},...r]))}hasResult(r){const t=r.result;return null!=t&&("object"!=typeof t||Object.keys(t).length>0)}cancelJob(r){this.dataService.settings.cancelJob(r).subscribe(()=>this.refresh())}static{this.\u0275fac=function(t){return new(t||u)(e.rXU(a.uSP),e.rXU(h.Ix),e.rXU(h.nX))}}static{this.\u0275cmp=e.VBU({type:u,selectors:[["vdr-job-list"]],features:[e.Vt3],decls:67,vars:80,consts:[["others",""],[1,"mr-2"],["type","checkbox","clrCheckbox","","name","live-update",3,"formControl"],["locationId","job-list"],[1,"mr-2",3,"change","addTag","hideSelected","multiple","markFirst","clearable","searchable","formControl"],[3,"value"],["colorType","warning"],["colorType","success"],["colorType","error"],["bindValue","name",3,"change","addTag","items","hideSelected","multiple","markFirst","clearable","searchable","formControl"],["ng-label-tmp","","ng-option-tmp",""],["id","job-list",3,"pageChange","itemsPerPageChange","items","itemsPerPage","totalItems","currentPage"],["id","id",3,"heading"],["id","created-at",3,"heading"],["id","job-queue-name",3,"heading","optional"],["id","job-data",3,"heading","optional"],["id","job-state",3,"heading"],["id","job-duration",3,"heading"],["id","job-result",3,"heading"],[4,"ngIf","ngIfElse"],[3,"colorFrom"],[4,"ngIf"],["vdrDropdownTrigger","",1,"button-small",3,"title"],["shape","details"],[1,"result-detail"],[3,"job"],["class","retry-info",4,"ngIf"],[1,"retry-info"],["vdrDropdownTrigger","",1,"button-small","mr-1"],["vdrDropdownTrigger","",1,"button-small"],["shape","exclamation-circle"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical","size","12"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click","disabled"],["shape","ban",1,"is-danger"]],template:function(t,s){1&t&&(e.j41(0,"vdr-page-header"),e.nrm(1,"vdr-page-title"),e.k0s(),e.j41(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left")(6,"clr-checkbox-wrapper",1),e.nrm(7,"input",2),e.j41(8,"label"),e.EFF(9),e.nI1(10,"translate"),e.k0s()()(),e.j41(11,"vdr-ab-right"),e.nrm(12,"vdr-action-bar-items",3),e.j41(13,"ng-select",4),e.bIt("change",function(){return s.refresh()}),e.j41(14,"ng-option",5)(15,"vdr-chip"),e.EFF(16),e.nI1(17,"translate"),e.k0s()(),e.j41(18,"ng-option",5)(19,"vdr-chip"),e.EFF(20),e.nI1(21,"translate"),e.k0s()(),e.j41(22,"ng-option",5)(23,"vdr-chip",6),e.EFF(24),e.nI1(25,"translate"),e.k0s()(),e.j41(26,"ng-option",5)(27,"vdr-chip",7),e.EFF(28),e.nI1(29,"translate"),e.k0s()(),e.j41(30,"ng-option",5)(31,"vdr-chip",8),e.EFF(32),e.nI1(33,"translate"),e.k0s()(),e.j41(34,"ng-option",5)(35,"vdr-chip",8),e.EFF(36),e.nI1(37,"translate"),e.k0s()()(),e.j41(38,"ng-select",9),e.nI1(39,"async"),e.bIt("change",function(){return s.refresh()}),e.DNE(40,S,3,2,"ng-template",10),e.k0s()()()(),e.j41(41,"vdr-data-table-2",11),e.nI1(42,"async"),e.nI1(43,"async"),e.nI1(44,"async"),e.nI1(45,"async"),e.bIt("pageChange",function(c){return s.setPageNumber(c)})("itemsPerPageChange",function(c){return s.setItemsPerPage(c)}),e.j41(46,"vdr-dt2-column",12),e.nI1(47,"translate"),e.DNE(48,U,1,1,"ng-template"),e.k0s(),e.j41(49,"vdr-dt2-column",13),e.nI1(50,"translate"),e.DNE(51,J,2,3,"ng-template"),e.k0s(),e.j41(52,"vdr-dt2-column",14),e.nI1(53,"translate"),e.DNE(54,A,2,2,"ng-template"),e.k0s(),e.j41(55,"vdr-dt2-column",15),e.nI1(56,"translate"),e.DNE(57,Y,1,1,"ng-template"),e.k0s(),e.j41(58,"vdr-dt2-column",16),e.nI1(59,"translate"),e.DNE(60,K,3,3,"ng-template"),e.k0s(),e.j41(61,"vdr-dt2-column",17),e.nI1(62,"translate"),e.DNE(63,q,2,3,"ng-template"),e.k0s(),e.j41(64,"vdr-dt2-column",18),e.nI1(65,"translate"),e.DNE(66,Q,3,3,"ng-template"),e.k0s()()()),2&t&&(e.R7$(7),e.Y8G("formControl",s.liveUpdate),e.R7$(2),e.JRh(e.bMT(10,42,"common.live-update")),e.R7$(4),e.Y8G("addTag",!1)("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",s.stateFilter),e.R7$(),e.Y8G("value",""),e.R7$(2),e.JRh(e.bMT(17,44,"system.job-state-all")),e.R7$(2),e.Y8G("value","PENDING"),e.R7$(2),e.JRh(e.bMT(21,46,"system.job-state-pending")),e.R7$(2),e.Y8G("value","RUNNING"),e.R7$(2),e.JRh(e.bMT(25,48,"system.job-state-running")),e.R7$(2),e.Y8G("value","COMPLETED"),e.R7$(2),e.JRh(e.bMT(29,50,"system.job-state-completed")),e.R7$(2),e.Y8G("value","FAILED"),e.R7$(2),e.JRh(e.bMT(33,52,"system.job-state-failed")),e.R7$(2),e.Y8G("value","CANCELLED"),e.R7$(2),e.JRh(e.bMT(37,54,"system.job-state-cancelled")),e.R7$(2),e.Y8G("addTag",!1)("items",e.bMT(39,56,s.queues$))("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",s.queueFilter),e.R7$(3),e.Y8G("items",e.bMT(42,58,s.items$))("itemsPerPage",e.bMT(43,60,s.itemsPerPage$))("totalItems",e.bMT(44,62,s.totalItems$))("currentPage",e.bMT(45,64,s.currentPage$)),e.R7$(5),e.Y8G("heading",e.bMT(47,66,"common.id")),e.R7$(3),e.Y8G("heading",e.bMT(50,68,"common.created-at")),e.R7$(3),e.Y8G("heading",e.bMT(53,70,"system.job-queue-name"))("optional",!1),e.R7$(3),e.Y8G("heading",e.bMT(56,72,"system.job-data"))("optional",!1),e.R7$(3),e.Y8G("heading",e.bMT(59,74,"system.job-state")),e.R7$(3),e.Y8G("heading",e.bMT(62,76,"system.job-duration")),e.R7$(3),e.Y8G("heading",e.bMT(65,78,"system.job-result")))},dependencies:[d.U4n,d.aZZ,d.Jej,d.eAx,i.bT,m.Zm,m.BC,m.l_,g.vr,g.xt,g.Uq,g.ZZ,a.nGW,a.wL$,a.TXc,a.wux,a.Vr5,a.PsF,a.qLY,a.j$H,a.Mrl,a.TJf,a.TcB,a.IMU,a.Y9G,a.yvH,a.jgO,a.DDl,a.eH4,_,i.Jj,f.D9,a.Ex,a.nnP,a.bBS],styles:[".result-detail[_ngcontent-%COMP%]{margin:0 12px}.retry-info[_ngcontent-%COMP%]{margin-inline-start:6px;color:var(--color-grey-400)}"],changeDetection:0})}}const E=[{path:"jobs",component:u,data:{breadcrumb:(0,j.x)("breadcrumb.job-queue")}},{path:"system-status",component:p,data:{breadcrumb:(0,j.x)("breadcrumb.system-status")}}];class b{static{this.\u0275fac=function(t){return new(t||b)}}static{this.\u0275mod=e.$C({type:b})}static{this.\u0275inj=e.G2t({imports:[a.GgS,h.iI.forChild(E)]})}}}}]);
//# sourceMappingURL=643.70957e675e918daa.js.map